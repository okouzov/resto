<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ресто</title>

<meta name="theme-color" content="#16a34a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Ресто">

<link rel="manifest" href="manifest.webmanifest?v=20251231014510">
<link rel="icon" href="icon-192.png">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
:root{
  --bg:#f6f7fb;--card:#fff;--text:#111827;--muted:#374151;
  --border:#e5e7eb;
  --green:#16a34a;
  --yellow:#fde68a;
  --danger:#b91c1c;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
.wrap{max-width:520px;margin:0 auto;padding:16px}
.card{background:var(--card);border-radius:20px;padding:16px}
h1{font-size:20px;margin:0 0 14px}

.label{font-size:16px;margin-bottom:8px}
.unit{font-size:16px}

.section{margin-bottom:14px}
.row{display:flex;gap:10px}

.field{flex:1;display:flex;align-items:center;gap:8px;
border:1px solid var(--border);border-radius:14px;padding:12px}
.field input{width:100%;border:0;font-size:22px;outline:none}

.actions{display:flex;gap:12px;margin-top:14px}
.btn{
  flex:1;
  border-radius:16px;
  padding:18px;
  font-size:22px;
  font-weight:800;
  border:none;
}
.btn.primary{
  background:var(--green);
  color:#fff;
}
.btn.secondary{
  background:var(--yellow);
  color:#000;
}

.result{
  margin-top:16px;
  padding:16px;
  border-radius:16px;
  background:#f1f5f9;
}
.big{font-size:28px;font-weight:900}
.sub{font-size:16px;margin-top:6px}

.section.error{
  background:#fff5f5;
  border-radius:16px;
  padding:12px;
}
.warn{color:var(--danger);font-weight:700}
</style>
</head>
<body>
<div class="wrap">
<div class="card">

<h1>Калкулатор за ресто</h1>

<div class="section" id="dueSection">
<div class="label">Дължима сума (EUR)</div>
<div class="row">
  <div class="field">
    <input id="dueMajor" inputmode="numeric" placeholder="0">
    <span class="unit">€</span>
  </div>
  <div class="field">
    <input id="dueMinor" inputmode="numeric" placeholder="00">
    <span class="unit">ц</span>
  </div>
</div>
</div>

<div class="section">
<div class="label">Дадени пари (BGN)</div>
<div class="row">
  <div class="field">
    <input id="paidLev" inputmode="numeric" placeholder="0">
    <span class="unit">лв</span>
  </div>
  <div class="field">
    <input id="paidSt" inputmode="numeric" placeholder="00">
    <span class="unit">ст</span>
  </div>
</div>
</div>

<div class="actions">
<button class="btn primary" id="calcBtn">СМЕТНИ</button>
<button class="btn secondary" id="clearBtn">ИЗЧИСТИ</button>
</div>

<div class="result">
<div class="big" id="resultMain">—</div>
<div class="sub" id="resultSub">Въведи сума и натисни „Сметни“.</div>
</div>

</div>
</div>

<script>
const RATE=1.95583;
const dueSection=document.getElementById('dueSection');
const dueMajor=document.getElementById('dueMajor');
const dueMinor=document.getElementById('dueMinor');
const paidLev=document.getElementById('paidLev');
const paidSt=document.getElementById('paidSt');
const resultMain=document.getElementById('resultMain');
const resultSub=document.getElementById('resultSub');

function n(v){return parseInt(v||'0',10)||0}
function norm(el){
  let v=el.value.replace(/\D/g,'');
  if(v.length===1)v='0'+v;
  if(v.length>2)v=v.slice(-2);
  el.value=v;
}
[dueMinor,paidSt].forEach(e=>e.addEventListener('blur',()=>norm(e)));

document.getElementById('calcBtn').onclick=()=>{
  dueSection.classList.remove('error');
  if(!dueMajor.value&&!dueMinor.value){
    dueSection.classList.add('error');
    resultSub.innerHTML='<span class="warn">Моля, въведи дължима сума.</span>';
    return;
  }
  const due=n(dueMajor.value)*100+n(dueMinor.value);
  const paid=n(paidLev.value)*100+n(paidSt.value);
  const dueBGN=Math.round((due/100)*RATE*100);
  const change=paid-dueBGN;
  const eur=Math.round((change/100)/RATE*100);
  if(change<0){
    resultMain.textContent='НЕДОСТИГ';
    resultSub.innerHTML='<span class="warn">Дадените пари не стигат.</span>';
    return;
  }
  resultMain.textContent=(eur/100).toFixed(2)+' € ('+(change/100).toFixed(2)+' лв)';
  resultSub.textContent='Ресто за връщане';
};

document.getElementById('clearBtn').onclick=()=>{
  [dueMajor,dueMinor,paidLev,paidSt].forEach(i=>i.value='');
  resultMain.textContent='—';
  resultSub.textContent='Въведи сума и натисни „Сметни“.';
  dueSection.classList.remove('error');
};

window.addEventListener('load',()=>dueMajor.focus());

if('serviceWorker'in navigator){
  navigator.serviceWorker.register('./sw.js?v=20251231014510');
}
</script>
</body>
</html>
